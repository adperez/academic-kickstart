---
title: "Correlation"
date: "Week 3"
output:
  rmdformats::readthedown:
    highlight: kate
css: custom.css
---

<style type="text/css">

body{ /* Normal  */
      font-size: 26px;
      line-height: 1.2;
  }
p{ /* Normal  */
      font-size: 26px;
      line-height: 1.2;
  }
 li{ /* Normal  */
      font-size: 24px;
      line-height: 1.2;
       padding: 5px 0px;
  }
td {  /* Table  */
  font-size: 8px;
}
h1.title {
  font-size: 38px;

}
h1 { /* Header 1 */
  font-size: 48px;

}
h2 { /* Header 2 */
    font-size: 36px;

}
h3 { /* Header 3 */
  font-size: 30px;


}

h4 { /* Header 4 */
  font-size: 28px;


}

code.r{ /* Code block */
    font-size: 40px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 18px;
}
</style>

```{r setup, echo=FALSE, cache=FALSE, warning = F, message = F}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

```{r, echo = F,cache=FALSE, warning = F, message = F}
library(knitr)
library(formatR)
opts_chunk$set(tidy.opts=list(width.cutoff=65),tidy=TRUE)

```
## Aims

Measuring relationships

* Scatterplots
* Covariance
* Pearson’s correlation coefficient

Interpreting correlations

* Causality

Partial correlations

## What is a Correlation?

It is a way of measuring the extent to which two variables are related  

It measures the pattern of responses across variables

## Correlation Relationships

### Very Small Relationship

![](images/week3/image1.png)

### Positive Relationship
![](images/week3/image2.png)

### Negative Relationship
![](images/week3/image3.png)

## Measuring Relationships

We need to see whether as one variable increases, the other increases, decreases or stays the same  

This can be done by calculating the covariance (co-vary, vary together)  

* We look at how much each score deviates from the mean
* If both variables deviate from the mean by the same amount, they are likely to be related

### Example 

![](images/week3/image4.png)

![](images/week3/image5.png)

## Variance

The variance tells us by how much scores deviate from the mean for a single variable  

![](images/week3/image6.png)

## Covariance

**Covariance** is similar – it tells is by how much scores on two variables differ from their respective means  

1. Calculate the error between the mean and each subject’s score for the first variable (x).
2. Calculate the error between the mean and their score for the second variable (y).
3. Multiply these error values.
4. Add these values and you get the cross product deviations.
5. The covariance is the average cross-product deviations:

![](images/week3/image7.png)

### Covariance Example

![](images/week3/image5.png)

![](images/week3/image8.png)

## Problems with Covariance

It depends upon the units of measurement

* e.g. the covariance of two variables measured in miles might be 4.25, but if the same scores are converted to kilometres, the covariance is 11

One solution: standardize it!

* Divide by the standard deviations of both variables

The standardized version of covariance is known as the **correlation coefficient**

* It is relatively unaffected by units of measurement.

## Correlation Coefficient

![](images/week3/image9.png)

### Applying it to our example

![](images/week3/image4.png)

![](images/week3/image8.png)

![](images/week3/image10.png)

## Things to Know about the Correlation

It varies between -1 and +1

* 0 = no relationship

The sign tells us direction, not magnitude  

It is an effect size

* ±.1 = small effect
* ±.3 = medium effect
* ±.5 = large effect

Coefficient of determination, r^2

* By squaring the value of r you get the proportion of variance in one variable shared by the other

## Correlation and Causality

**The third-variable problem:** In any correlation, causality between two variables cannot be assumed because there may be other measured or unmeasured variables affecting the results  

**Direction of causality:** Correlation coefficients say nothing about which variable causes the other to change, *correlation does not imply causation*

## Partial and Semi-partial Correlations

**Partial correlation:** Measures the relationship between two variables, controlling for the effect that a third variable has on them both  

**Semi-partial correlation:** Measures the relationship between two variables controlling for the effect that a third variable has on only one of the others

![](images/week3/image15.png) 



### Correlation Example: 

<a href = http://faculty.cas.usf.edu/mbrannick/regression/Part3/Partials.html> Example adapted from here </a>

Suppose we have SAT-Verbal scores and both high school and college freshman grade point averages from 10 people  

We might want to estimate the relations among some of these while holding others constant through statistical control 

*Note: corr.test from the psych package is also frequently used because it provides p-values, but it can only run one correlation at a time. cor allows for multiple correlations (a matrix) to be run.*

```{r, eval = F, echo = T}
corrs <- cor(scholar) 
# find the correlations and set them into an object called 'corrs'
corrs                 # print corrs
```

![](images/week3/image11.png)

```{r, eval = F, echo = T}
pairs(scholar)        # pairwise scatterplots
```

![](images/week3/image12.png)

All of the correlations are quite large  

We have three variables, X (HS GPA), Y(Fresh GPA), and Z (SAT). Partial correlation holds constant one variable when computing the relations two others  

Suppose we want to know the correlation between X (HS GPA) and Y (Fresh GPA) holding Z (SAT) constant for both X and Y. That would be the **partial correlation** between X and Y controlling for Z. Meaning, we could find the correlation (relationship) between HS GPA and Freshman GPA while controlling (holding constant) the effect of SAT score. Holding constant means that if we find an effect, it is not due to SAT score as we controlled for it.  

We want to know the correlation between the two grade point averages controlling for SAT-V. How highly correlated are these after controlling for scholastic ability? This would get at the importance of motivation, study habits, and other noncognitive variables. The R syntax using ‘pcor’ is:

```{r, eval = F, echo = T}
pcor.test(HSGPA,FGPA,SATV)
```


![](images/week3/image13.png)

The estimate is about .75, which is still a large correlation. Note that the syntax requires the two focal variables (X, Y) be listed first, and that the control variable (Z) be listed last. There can be more than one control variable.  

**Semipartial correlation** holds Z (HS GPA) constant for either X (SAT) or Y (Fresh GPA), but not both, so if we wanted to control X for Z, we could compute the semipartial correlation between X and Y holding Z constant for X. Meaning, we could find the correlation (relationship) between SAT scores and Freshman GPA while controlling (holding constant) the effect of HS GPA on SAT scores only.  

Suppose that we want to control high school GPA for SAT-V, but we want no statistical control applied to freshman GPA. This would address how well high school GPA (HSGPA) correlated with college freshman GPA (FGPA) above and beyond SAT-V.

The R syntax using ‘spcor’ is:

```{r, eval = F, echo = T}
spcor.test(FGPA,HSGPA,SATV)
```

![](images/week3/image14.png)

Note that the statistical control is applied to the right-hand partner of the first two variables (here HSGPA), and the control variable is the last in the list (here SATV)  

Note also that the semipartial correlation is smaller than was the partial correlation. That part of freshman GPA that is attributable to cognitive ability was removed in the partial correlation, but it remains in the semipartial, so the resulting correlation is smaller in the semipartial.  

**However, a partial/semipartial correlation is essentially a simple regression, which is likely a better tool to use. We will cover this next week!**